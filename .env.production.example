# EuraFlow 生产环境配置模板
# 复制此文件为 .env 并修改相应配置
# 所有环境变量必须以 EF__ 开头

# ===========================================
# 数据库配置
# ===========================================
EF__DB_HOST=localhost
EF__DB_PORT=5432
EF__DB_NAME=euraflow
EF__DB_USER=euraflow
EF__DB_PASSWORD=<更换为强密码>

# 连接池配置（生产环境推荐值）
# 支持 100 用户 + 50 并发，预计需要 70-100 连接
EF__DB_POOL_SIZE=40           # 基础连接池大小（默认 20）
EF__DB_MAX_OVERFLOW=60        # 允许的溢出连接数（默认 40）
# 总连接数 = pool_size + max_overflow = 100
# 注意：PostgreSQL max_connections 需 >= 150

# ===========================================
# Redis 配置
# ===========================================
EF__REDIS_HOST=localhost
EF__REDIS_PORT=6379
EF__REDIS_DB=0
# Redis 连接池已在代码中配置 max_connections=50

# ===========================================
# API 配置
# ===========================================
EF__API_HOST=0.0.0.0
EF__API_PORT=8000
EF__API_PREFIX=/api/ef/v1
EF__API_DEBUG=false           # 生产环境必须为 false

# ===========================================
# 安全配置
# ===========================================
# 生成强密钥: python -c "import secrets; print(secrets.token_urlsafe(64))"
EF__SECRET_KEY=<替换为64位以上随机密钥>
EF__ALGORITHM=HS256
EF__ACCESS_TOKEN_EXPIRE_MINUTES=480  # 8小时

# ===========================================
# Celery 配置
# ===========================================
EF__CELERY_BROKER_URL=redis://localhost:6379/0
EF__CELERY_RESULT_BACKEND=redis://localhost:6379/1
EF__CELERY_CONCURRENCY=12           # Celery Worker 并发数（CPU核心 × 2-3）

# ===========================================
# ARQ 任务调度
# ===========================================
EF__USE_ARQ_DISPATCHER=true   # 生产环境推荐开启

# ===========================================
# 日志配置
# ===========================================
EF__LOG_LEVEL=INFO            # 生产环境使用 INFO
EF__LOG_FORMAT=json

# ===========================================
# 监控配置
# ===========================================
EF__METRICS_ENABLED=true
EF__METRICS_PREFIX=ef
EF__TRACE_ENABLED=false

# ===========================================
# 插件配置
# ===========================================
EF__PLUGIN_DIR=plugins
EF__PLUGIN_AUTO_LOAD=true
EF__PLUGIN_CONFIG_FILE=plugin.json

# ===========================================
# 速率限制（建议生产环境开启）
# ===========================================
EF__RATE_LIMIT_ENABLED=true
EF__RATE_LIMIT_DEFAULT=100/minute  # 默认每分钟 100 次

# ===========================================
# 业务阈值
# ===========================================
EF__INVENTORY_DEFAULT_THRESHOLD=5
EF__PRICE_MIN_MARGIN=0.2
