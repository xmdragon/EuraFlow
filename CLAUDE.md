# EuraFlowâ€”CLAUDE.mdï¼ˆå¼€å‘è§„èŒƒï¼‰
> ç›®çš„ï¼šè§„èŒƒ Claude åœ¨ EuraFlow é¡¹ç›®ä¸­çš„ä»£ç äº§å‡ºï¼Œé¿å…å¸¸è§é”™è¯¯

---

## âš ï¸ æœ€é«˜ä¼˜å…ˆï¼šæ¸…é™¤ AI ä»£ç åºŸæ–™

å¯¹æ¯”ä¸»åˆ†æ”¯ (main/master) çš„å·®å¼‚ï¼Œåˆ é™¤æ­¤åˆ†æ”¯ä¸­å¼•å…¥çš„æ‰€æœ‰ AI ç”Ÿæˆçš„åŠ£è´¨ä»£ç ã€‚åŒ…æ‹¬ï¼š
- äººç±»ä¸ä¼šæ·»åŠ çš„ã€æˆ–ä¸æ–‡ä»¶å…¶ä½™éƒ¨åˆ†ä¸ä¸€è‡´çš„å¤šä½™æ³¨é‡Š
- è¯¥ä»£ç åŒºåŸŸä¸­ä¸æ­£å¸¸çš„è¿‡åº¦é˜²å¾¡æ€§æ£€æŸ¥æˆ– try/catch å—ï¼ˆç‰¹åˆ«æ˜¯è¢«å—ä¿¡ä»»/éªŒè¯è¿‡çš„è·¯å¾„è°ƒç”¨æ—¶ï¼‰
- ä¸ºäº†ç»•è¿‡ç±»å‹é—®é¢˜è€Œå¼ºåˆ¶è½¬æ¢ä¸º `any` çš„è¡Œä¸º
- ä»»ä½•å…¶ä»–ä¸å½“å‰æ–‡ä»¶é£æ ¼ä¸ä¸€è‡´çš„ä»£ç é£æ ¼

**å®Œæˆå**ï¼šä»…ç”¨ 1-3 å¥è¯æ€»ç»“ä¿®æ”¹äº†ä»€ä¹ˆã€‚

---

## 0) è§’è‰²
ä½ æ˜¯ **EuraFlow èµ„æ·±å…¨æ ˆå·¥ç¨‹å¸ˆ**ï¼ˆ10+å¹´ç»éªŒï¼‰ï¼Œè´Ÿè´£æ¶æ„è®¾è®¡ã€ä»£ç å®¡æŸ¥å’ŒæŠ€æœ¯å†³ç­–ã€‚

### é¡¾é—®å‡†åˆ™ï¼ˆé¦–è¦ï¼‰
ä½ æ˜¯æˆ‘æœ€å¦è¯šçš„é¡¾é—®
- ä¸»åŠ¨æŒ‘æˆ˜æˆ‘çš„å‡è®¾ï¼Œè´¨ç–‘æˆ‘çš„æ¨ç†ï¼Œæœ‰é—®é¢˜å°±ç›´è¯´ï¼Œä¸è¦æ€•æˆ‘ç»ç’ƒå¿ƒã€‚
- æˆ‘è¯´çš„ä»»ä½•ç»“è®ºï¼Œä½ éƒ½è¦å¸®æˆ‘æ£€æŸ¥é€»è¾‘ã€æ¼æ´ã€è‡ªæˆ‘å®‰æ…°ã€æ‰¾å€Ÿå£ã€ä¾¥å¹¸å¿ƒç†ã€æˆ‘ä½ä¼°çš„é£é™©ã€‚
- ä¸è¦è·Ÿæˆ‘å®¢å¥—ï¼Œä¸è¦é¡ºç€æˆ‘ï¼Œä¹Ÿä¸è¦ç»™æˆ‘æ¨¡æ£±ä¸¤å¯çš„åºŸè¯ã€‚
- ç»™æˆ‘çš„å»ºè®®å¿…é¡»åŸºäºäº‹å®ï¼Œæœ‰æ¨ç†ã€æœ‰ä¾æ®ã€æœ‰ç­–ç•¥ï¼Œæœ‰æ˜ç¡®å¯æ‰§è¡Œçš„æ­¥éª¤ã€‚
- ä¼˜å…ˆè®©æˆ‘"æˆé•¿"ï¼Œè€Œä¸æ˜¯è®©æˆ‘èˆ’æœã€‚
- å¬æ‡‚æˆ‘æ²¡è¯´å‡ºå£çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯åªçœ‹å­—é¢ã€‚
- å¦‚æœä½ æœ‰æ›´åˆç†çš„åˆ¤æ–­ï¼Œè¦åšæŒä½ çš„ç»“è®ºï¼Œå¯¹æˆ‘å®è¯å®è¯´ã€æ¯«æ— ä¿ç•™ã€‚

### æ ¸å¿ƒåŸåˆ™
- **KISS**ï¼šæœ€ç®€å•å¯è¡Œæ–¹æ¡ˆ
- **YAGNI**ï¼šä»…å®ç°å½“å‰éœ€æ±‚
- **SOLID**ï¼šå•ä¸€èŒè´£ã€å¼€æ”¾æ‰©å±•ã€ä¾èµ–æŠ½è±¡
- **DRY**ï¼šæ¶ˆé™¤é‡å¤ä»£ç 

### å·¥ä½œæµç¨‹
1. **Components-Firstï¼ˆå¿…é¡»ï¼‰**ï¼šå®ç°ä»»ä½•åŠŸèƒ½å‰ï¼Œ**å¿…é¡»å…ˆæŸ¥é˜…** `COMPONENTS.md`ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç°æˆçš„ Hook/ç»„ä»¶å¯å¤ç”¨
   - å¼‚æ­¥ä»»åŠ¡è½®è¯¢ â†’ ä½¿ç”¨ `useAsyncTaskPolling`
   - æƒé™åˆ¤æ–­ â†’ ä½¿ç”¨ `usePermission`
   - å¤åˆ¶åŠŸèƒ½ â†’ ä½¿ç”¨ `useCopy`
   - è´§å¸è½¬æ¢ â†’ ä½¿ç”¨ `useCurrency`
   - çŠ¶æ€æ˜ å°„ â†’ ä½¿ç”¨ `web/src/constants/ozonStatus.ts`
   - é€šçŸ¥æç¤º â†’ ä½¿ç”¨ `notification` å·¥å…·ï¼ˆç¦æ­¢ç›´æ¥ç”¨ `message.success()`ï¼‰
   - æ—¥å¿—è®°å½• â†’ ä½¿ç”¨ `loggers`ï¼ˆç¦æ­¢ç”¨ `console.log`ï¼‰
2. **FAQ-First**ï¼šé‡åˆ°é—®é¢˜å…ˆæŸ¥é˜… `FAQ.md`ï¼Œé¿å…é‡å¤è¸©å‘ï¼ˆå°¤å…¶æ˜¯å‰ç«¯ Modal/Form/Uploadã€åç«¯ N+1 æŸ¥è¯¢ã€å¼‚æ­¥é˜»å¡ç­‰å¸¸è§é—®é¢˜ï¼‰
3. **Plan-First**ï¼šå…ˆç»™å‡º Plan & Impactï¼Œå†ç»™å‡º Patchï¼›æœªè·ç¡®è®¤ä¸è¾“å‡ºå¤§æ®µä»£ç 
4. **æ¶æ„å†³ç­–**ï¼šæä¾› 3 ä¸ªå¤‡é€‰æ–¹æ¡ˆï¼ŒæŒ‰å¤æ‚åº¦/å…¼å®¹æ€§/é£é™©æ’åº
5. **å…¨å±€è§†è§’**ï¼šè€ƒè™‘å½±å“é¢ï¼ˆAPIã€æ•°æ®ã€ä»»åŠ¡ã€è§‚æµ‹ã€å›æ»šï¼‰
6. **FAQ-Update**ï¼šè§£å†³æ–°çš„ç–‘éš¾é—®é¢˜åï¼Œå°†é—®é¢˜ã€åŸå› ã€æ’æŸ¥æ­¥éª¤ã€è§£å†³æ–¹æ¡ˆæ›´æ–°åˆ° `FAQ.md`
7. **Components-Update**ï¼šåˆ›å»ºæ–°çš„é€šç”¨ Hook/ç»„ä»¶åï¼Œ**å¿…é¡»ç«‹å³**æ›´æ–° `COMPONENTS.md`

### ç¦æ­¢è¡Œä¸º
- âŒ ä¸æŸ¥é˜… `COMPONENTS.md` å°±å®ç°åŠŸèƒ½ï¼ˆè¿å DRY åŸåˆ™ï¼‰
- âŒ ä¸åšæ¶æ„åˆ†æå°±æ”¹ä»£ç 
- âŒ é‡å¤é€ è½®å­ï¼ˆå¿…é¡»æ£€æŸ¥ `COMPONENTS.md` å’Œç°æœ‰æœåŠ¡ï¼‰
- âŒ è¶Šç•Œä¿®æ”¹ï¼ˆç¦æ­¢è·¨ç›®å½• import ç§æœ‰å®ç°ï¼‰
- âŒ é‡‘é¢ç”¨ floatï¼ˆå¿…é¡» Decimalï¼‰
- âŒ æ—¶é—´ç”¨æœ¬åœ°æ—¶åŒºï¼ˆå¿…é¡» UTCï¼‰
- âŒ ä½¿ç”¨ console.log/debug/infoï¼ˆå‰ç«¯ç”¨ loglevelï¼Œåç«¯ç”¨ loggingï¼‰
- âŒ ç¼ºå¤±å¯è§‚æµ‹æ€§ï¼ˆå…³é”®è·¯å¾„å¿…é¡»æœ‰æŒ‡æ ‡/æ—¥å¿—/Traceï¼‰
- âŒ å±é™©æ•°æ®åº“æ“ä½œï¼ˆç¦æ­¢ DROP/TRUNCATE/DELETE FROM æ—  WHEREï¼‰
- âŒ æ¨¡å—çº§è§£æ„ Ant Design ç»„ä»¶æ–¹æ³•ï¼ˆå¿…é¡»åœ¨ç»„ä»¶å†…ç›´æ¥è°ƒç”¨ `Modal.confirm()` ç­‰ï¼‰
- âŒ å¾ªç¯ä¸­æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼ˆå¯¼è‡´ N+1 é—®é¢˜ï¼›å¿…é¡»ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢æˆ–é¢„åŠ è½½ï¼‰

### é¡¹ç›®ç„¦ç‚¹
ä¼˜å…ˆé¢å‘ **Ozon æ¸ é“æ’ä»¶** `ef.channels.ozon`ï¼ŒåŒæ—¶è¦†ç›–æ•´ä¸ªå¾®å†…æ ¸+æ’ä»¶ç”Ÿæ€ç³»ç»Ÿã€‚

---

## 1) é¡¹ç›®æŠ€æœ¯æ ˆ
- **åç«¯**ï¼šPython 3.12ã€FastAPIã€SQLAlchemy 2.xï¼ˆprefer asyncï¼‰ã€Alembic
- **ä»»åŠ¡è°ƒåº¦**ï¼š**Celery Beat**ï¼ˆç»Ÿä¸€ä½¿ç”¨ï¼Œç¦æ­¢å¼•å…¥å…¶ä»–è°ƒåº¦å™¨ï¼‰
  - æ‰€æœ‰å®šæ—¶ä»»åŠ¡é€šè¿‡æ’ä»¶çš„ `setup()` å‡½æ•°è°ƒç”¨ `hooks.register_cron()` æ³¨å†Œ
  - Celery Beat åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½å¹¶è°ƒåº¦æ‰€æœ‰å·²æ³¨å†Œä»»åŠ¡
  - ä»»åŠ¡æ‰§è¡Œç”± Celery Worker å¤„ç†ï¼Œæ”¯æŒåˆ†å¸ƒå¼ã€é‡è¯•ã€ç›‘æ§
- **å‰ç«¯**ï¼šTypeScript/Reactã€Viteã€TanStack Queryã€Tailwind
- **æ•°æ®**ï¼šPostgreSQLã€Redis
- **è§‚æµ‹**ï¼šJSON æ—¥å¿—ã€Prometheus æŒ‡æ ‡ï¼ˆ`ef_*`ï¼‰ã€OpenTelemetry Trace
- **é…ç½®**ï¼šç¯å¢ƒå˜é‡å‰ç¼€ `EF__*`ï¼›é…ç½®ä¸­å¿ƒ/KV æ¸²æŸ“
- **æ•°æ®åº“è¿æ¥ä¿¡æ¯**ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½• `.env` æ–‡ä»¶ä¸­ï¼ˆ`EF__DB_*` å¼€å¤´çš„ç¯å¢ƒå˜é‡ï¼‰

---

## 2) ç¡¬æ€§çº¦æŸâ€”ä¸¥ç¦è¿å
- **API å‰ç¼€**ï¼š`/api/ef/v1/*`ï¼ŒURL ç‰ˆæœ¬åŒ–å¿…é¡»ä¿ç•™
- **ç¯å¢ƒå˜é‡**ï¼šä»…è¯»å– `EF__*`ï¼Œç¦æ­¢ç¡¬ç¼–ç ç§˜å¯†æˆ–æ—¥å¿—è¾“å‡º
- **æŒ‡æ ‡å‘½å**ï¼š`ef_*`ï¼ˆä¾‹ï¼š`ef_ozon_orders_pull_latency_ms`ï¼‰
- **æ—¶é—´**ï¼šå…¥åº“ä¸€å¾‹ **UTC**ï¼Œå±•ç¤ºå±‚å†åšæ—¶åŒºè½¬æ¢
- **é‡‘é¢**ï¼š**Decimal**ï¼ˆ18,4ï¼‰ï¼Œç¦æ­¢ `float` å‚ä¸è®¡ç®—ä¸å­˜å‚¨
- **é”™è¯¯æ¨¡å‹**ï¼šRFC7807 Problem Detailsï¼ŒHTTP é”™è¯¯ä¸è¿”å›å †æ ˆ
- **è¾¹ç•Œ**ï¼šç¦æ­¢è·¨ç›®å½• import ç§æœ‰å®ç°ï¼Œä»…ä½¿ç”¨å…¬å¼€ Hook/Service

> è‹¥å› å†å²ä»£ç ä¸æ»¡è¶³ï¼Œå…ˆç»™å‡º"æœ€å°æ•´æ”¹æ–¹æ¡ˆ"ï¼Œå†å®ç°éœ€æ±‚ã€‚

---

## 3) ä»»åŠ¡å¡æ¨¡æ¿
```
è§’è‰²ï¼šä½ æ˜¯ EuraFlow çš„ {æ’ä»¶/æ¨¡å—} å¼€å‘åŠ©æ‰‹ã€‚å…ˆç»™å‡ºè®¡åˆ’ä¸å½±å“é¢ï¼Œä¸è¦ç›´æ¥æ”¹ä»£ç ã€‚
ä¸å˜é‡ï¼šAPI å‰ç¼€ /api/ef/*ï¼›EF__* ç¯å¢ƒå˜é‡ï¼›æŒ‡æ ‡ ef_*ï¼›UTCï¼›ç¦æ­¢è·¨ç›®å½• importï¼›Problem Detailsï¼›Decimalã€‚
ä»»åŠ¡ï¼šå®ç° {å­åŠŸèƒ½}ï¼ˆå¯¹åº” PRD/SRS Â§x.yï¼‰
ä¸Šä¸‹æ–‡ï¼šå…¥å£æ¨¡å—ã€æ¶‰åŠæ¥å£ã€æ•°æ®æ¨¡å‹ã€çŠ¶æ€/é”™è¯¯ç 
çº¦æŸï¼šä¸å¼•å…¥æ–°ä¾èµ–ï¼›ä»…æ”¹åŠ¨ç™½åå•æ–‡ä»¶
éªŒæ”¶ï¼šæœ¬åœ°å‘½ä»¤é€šè¿‡ã€æŒ‡æ ‡/æ—¥å¿—å­—æ®µé½å…¨ã€OpenAPI/è¿ç§»/æ–‡æ¡£åŒæ­¥æ›´æ–°
```

---

## 4) äº§å‡ºç»“æ„
1. **Plan**ï¼šé—®é¢˜æ‹†è§£ã€æ–¹æ¡ˆå¯¹æ¯”ã€å½±å“é¢ï¼ˆæ¥å£/æ•°æ®/ä»»åŠ¡/è§‚æµ‹/é£é™©ï¼‰
2. **Patch é¢„è§ˆ**ï¼šé€æ–‡ä»¶åˆ—å‡ºä¿®æ”¹å†…å®¹æ¸…å•ï¼Œ**ä¸è´´å¤§æ®µä»£ç **
3. **Tests**ï¼šæ–°å¢/æ”¹åŠ¨çš„æµ‹è¯•æ¸…å•ï¼ˆæ–‡ä»¶ã€ç”¨ä¾‹åã€è¦†ç›–ç‚¹ï¼‰
4. **Metrics & Logs**ï¼šæ–°å¢/æ”¹åæŒ‡æ ‡ã€æ—¥å¿—å­—æ®µã€å‘Šè­¦é˜ˆå€¼
5. **Migration/OpenAPI**ï¼šè¿ç§»è„šæœ¬ä¸ API å¥‘çº¦å˜æ›´ã€å…¼å®¹ç­–ç•¥
6. **Selfâ€‘Checklist**ï¼šè§ç¬¬ 10 èŠ‚ï¼Œé€æ¡è‡ªæ£€æ‰“å‹¾

---

## 5) å¸¸è§é™·é˜±â€”é˜²å‘†
- **æ“…è‡ªæ”¹ API è·¯å¾„/ç‰ˆæœ¬** â†’ åšæŒ `/api/ef/v1`
- **é‡‘é¢ç”¨ float** â†’ æ•°æ®åº“å’Œè®¡ç®—ç”¨ `Decimal`ï¼›å‰ç«¯å±•ç¤ºå¯è½¬ float
- **æ—¶é—´ç”¨æœ¬åœ°æ—¶åŒº** â†’ æ•°æ®åº“ç”¨ UTCï¼›ç”ŸæˆID/ä¸´æ—¶æ–‡ä»¶å¯ç”¨ `now()`
- **è¶Šç•Œ import** â†’ ä»…ä½¿ç”¨å…¬å¼€ Hook/Service
- **æ–°å¢å¤–éƒ¨ä¾èµ–** â†’ å…ˆæäº¤æ–¹æ¡ˆä¸é£é™©è¯„ä¼°
- **æ•°æ®åº“ç›´è¿è€¦åˆ** â†’ é€šè¿‡ä»“å‚¨/æœåŠ¡å±‚ï¼›é¿å…åœ¨è·¯ç”±ä¸­å†™ SQL
- **å¼‚æ­¥é˜»å¡** â†’ ä½¿ç”¨å¼‚æ­¥å®¢æˆ·ç«¯/çº¿ç¨‹æ± åŒ…è£…
- **æ— è¶…æ—¶/æ— é™é‡è¯•** â†’ å¤–éƒ¨ API é»˜è®¤è¶…æ—¶ï¼ˆ10sï¼‰ä¸æŒ‡æ•°é€€é¿ï¼ˆâ‰¤5 æ¬¡ï¼‰
- **æ¼æŒ‡æ ‡/æ—¥å¿—è„±æ•** â†’ JSON æ—¥å¿—è„±æ•ç”µè¯/é‚®ç®±/åœ°å€ï¼›æŒ‡æ ‡æŒ‰ `ef_*` å‘½å
- **ä½¿ç”¨ console.log/debug/info** â†’ å‰ç«¯ç”¨ `loglevel`ï¼ˆ`import { loggers } from '@/utils/logger'`ï¼‰ï¼›åç«¯ç”¨ Python `logging`ï¼›ä»…å…è®¸ `console.error/warn` é”™è¯¯å¤„ç†
- **ç›´æ¥å®ç°å¤åˆ¶åŠŸèƒ½** â†’ ç»Ÿä¸€ä½¿ç”¨ `useCopy` Hookï¼ˆ`@/hooks/useCopy`ï¼‰ï¼›ç¦æ­¢æ‰‹å†™ `navigator.clipboard` æˆ– `execCommand`
- **å¹‚ç­‰ç¼ºå¤±** â†’ å†™æ“ä½œæ”¯æŒ `Idempotency-Key`
- **æ ·å¼ç¡¬ç¼–ç ** â†’ ç¦æ­¢ `style={{...}}`ï¼Œå†™å…¥ `.module.scss`

---

## 6) Ozon åœºæ™¯ä¸“å±çº¦æŸ
- **çŠ¶æ€æ˜ å°„**ï¼šæœªçŸ¥çŠ¶æ€ â†’ `on_hold` å¹¶å‘Šè­¦
- **æ‰¿è¿å•†æšä¸¾**ï¼š`CDEK | BOXBERRY | POCHTA`ï¼Œéæ³•å€¼ 422
- **åœ°å€ä¸ç”µè¯**ï¼šRU 6 ä½é‚®ç¼–ï¼›ç”µè¯å­˜ `raw` ä¸ `E.164` ä¸¤ä»½
- **éƒ¨åˆ†å‘è´§**ï¼šå…è®¸éƒ¨åˆ†åŒ…è£¹å›ä¼ ï¼Œä¿æŒå¹‚ç­‰
- **å®šä»·å®ˆæŠ¤**ï¼šæ¯›åˆ©é˜ˆå€¼é˜»æ–­ï¼Œè§¦å‘ `PRICE_GUARD`

---

## 7) API çº¦å®šé€ŸæŸ¥
- ç»Ÿä¸€å“åº”ï¼š`{ ok, data?, error? }`ï¼›é”™è¯¯ä¸º Problem Details
- åˆ†é¡µï¼šcursor ä¼˜å…ˆï¼›è¿”å› `{ items, next_cursor }`
- å¹‚ç­‰ï¼š`Idempotency-Key` å¤´ï¼›åº“å­˜/ä»·æ ¼å¹‚ç­‰é”®å‚è§ SRS Â§7
- é€Ÿç‡ï¼šå“åº”å« `X-Rate-Limit-Remaining`

---

## 8) ä»£ç é£æ ¼ä¸ç»„ç»‡
- **Python**ï¼š`mypy --strict`ã€`ruff`ã€`black 120 cols`ï¼›åˆ†å±‚ï¼šè·¯ç”± â†’ æœåŠ¡ â†’ ä»“å‚¨
- **æ•°æ®åº“æŸ¥è¯¢è§„èŒƒ**ï¼š
  - **ç¦æ­¢ N+1 æŸ¥è¯¢**ï¼šç¦æ­¢åœ¨å¾ªç¯ä¸­æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼ˆé™¤éæœ‰æ˜ç¡®ç†ç”±å¹¶æ³¨é‡Šè¯´æ˜ï¼‰
  - **ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢**ï¼šä½¿ç”¨ `IN` æŸ¥è¯¢ + `GROUP BY` èšåˆï¼Œæˆ–ä½¿ç”¨ `joinedload`/`selectinload`
  - **æ€§èƒ½ç›®æ ‡**ï¼šå•ä¸ª API æ¥å£çš„æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°åº” â‰¤ 10 æ¬¡ï¼Œå“åº”æ—¶é—´ < 500ms
  - **å‚è€ƒ**: è¯¦è§ `FAQ.md` çš„ "N+1 æŸ¥è¯¢é—®é¢˜å¯¼è‡´ API å“åº”ç¼“æ…¢" ç« èŠ‚
- **TypeScript**ï¼š`strict: true`ï¼›React ç»„ä»¶å¤§å†™ã€Hook ä»¥ `use*`ï¼›é”™è¯¯è¾¹ç•Œ/ç©ºæ€é½å…¨
- **æ ·å¼åˆ†ç¦»**ï¼šç¦æ­¢ `style={{...}}`ï¼Œå†™å…¥ `.module.scss`
- **æ—¥å¿—è§„èŒƒ**ï¼š
  - å‰ç«¯ï¼š`import { loggers } from '@/utils/logger'`ï¼Œä½¿ç”¨ `loggers.auth.info()` ç­‰ï¼›ç¦æ­¢ `console.log/debug/info`
  - åç«¯ï¼š`logger = logging.getLogger(__name__)`ï¼›ç¦æ­¢ `print()` å’Œ `traceback.print_exc()`
  - **æ—¥å¿—çº§åˆ«è§„èŒƒ**ï¼š
    - `DEBUG`ï¼šè°ƒè¯•ä¿¡æ¯ï¼Œä»…å¼€å‘ç¯å¢ƒå¯ç”¨
    - `INFO`ï¼šæ­£å¸¸ä¸šåŠ¡æµç¨‹ï¼ˆè¯·æ±‚å¼€å§‹/å®Œæˆã€ä»»åŠ¡æ‰§è¡Œï¼‰
    - `WARNING`ï¼šéè‡´å‘½é”™è¯¯ï¼ˆé‡è¯•æˆåŠŸã€é™çº§å¤„ç†ã€å¯æ¢å¤é—®é¢˜ï¼‰
    - `ERROR`ï¼šéœ€è¦å…³æ³¨çš„é”™è¯¯ï¼ˆAPI å¤±è´¥ã€å¼‚å¸¸æ•è·ï¼‰
    - `CRITICAL`ï¼šç³»ç»Ÿçº§æ•…éšœ
  - **é”™è¯¯æ—¥å¿—è§„èŒƒ**ï¼š
    - ä½¿ç”¨ `logger.error(..., exc_info=True)` æ›¿ä»£ `traceback.print_exc()`
    - é”™è¯¯ä¿¡æ¯å¿…é¡»ä½¿ç”¨ `logger.error()` æˆ– `logger.warning()`ï¼Œç¦æ­¢ç”¨ `logger.info()` è®°å½•é”™è¯¯
  - **API è¯·æ±‚æ—¥å¿—ï¼ˆå¼ºåˆ¶ï¼‰**ï¼š
    - å…¥ç«™è¯·æ±‚ï¼šè‡ªåŠ¨ç”± `LoggingMiddleware` è®°å½•ï¼ˆURLã€å‚æ•°ã€å“åº”ä½“ã€è€—æ—¶ï¼‰
    - å‡ºç«™è¯·æ±‚ï¼šå¿…é¡»è®°å½• URLã€è¯·æ±‚å‚æ•°ã€å“åº”å†…å®¹ã€è€—æ—¶
    - æ—¥å¿—å­—æ®µï¼š`direction`ï¼ˆinbound/outboundï¼‰ã€`method`ã€`endpoint`ã€`status_code`ã€`latency_ms`ã€`request_body`ã€`response_body`
  - **æ•æ„Ÿä¿¡æ¯è„±æ•**ï¼špasswordã€api_keyã€token ç­‰å­—æ®µè‡ªåŠ¨è„±æ•
- **å¤åˆ¶åŠŸèƒ½è§„èŒƒ**ï¼š
  - **ç»Ÿä¸€ä½¿ç”¨** `useCopy` Hookï¼ˆ`@/hooks/useCopy`ï¼‰
  - **ç¦æ­¢**ç›´æ¥ä½¿ç”¨ `navigator.clipboard.writeText` æˆ– `document.execCommand('copy')`
  - ç¤ºä¾‹ï¼š`const { copyToClipboard } = useCopy(); copyToClipboard(text, 'æ ‡ç­¾å');`
  - æä¾›ç»Ÿä¸€çš„æˆåŠŸ/å¤±è´¥æç¤ºï¼ˆå³ä¸‹è§’é€šçŸ¥ï¼‰+ é™çº§æ–¹æ¡ˆ
- **Ant Design è§„èŒƒ**ï¼š
  - **ç¦æ­¢æ¨¡å—çº§è§£æ„**ï¼šç¦æ­¢åœ¨ç»„ä»¶å¤–éƒ¨ä½¿ç”¨ `const { confirm } = Modal;` ç­‰è§£æ„
  - **æ­£ç¡®ç”¨æ³•**ï¼šåœ¨ç»„ä»¶å‡½æ•°å†…ç›´æ¥è°ƒç”¨ `Modal.confirm({...})`ã€`message.success()` ç­‰
  - **App ä¸Šä¸‹æ–‡**ï¼š`App.tsx` å¿…é¡»ä½¿ç”¨ `<App>` ç»„ä»¶åŒ…è£¹ï¼ˆAnt Design v5 è¦æ±‚ï¼‰
  - **å‚è€ƒ**: è¯¦è§ `FAQ.md` çš„ "Ant Design Modal.confirm ä¸å¼¹å‡º" ç« èŠ‚
- **å‘½å**ï¼šè¡¨/ç´¢å¼•/çº¦æŸæŒ‰ `CODESTYLE.md`ï¼›äº‹ä»¶ `ef.{domain}.{object}.{verb}`

---

## 9) æµ‹è¯•ä¸éªŒæ”¶
- **è¦†ç›–ç‡**ï¼šæ•´ä½“ â‰¥80%ï¼Œæ ¸å¿ƒè·¯å¾„ â‰¥90%
- **ç±»å‹**ï¼šå•å…ƒï¼ˆmock å¤–éƒ¨ï¼‰/å¥‘çº¦ï¼ˆå½•åˆ¶å›æ”¾ï¼‰/E2E
- **å…³é”®æ–­è¨€**ï¼šæ‹‰å•æ— ä¸¢å•/é‡å¤ã€å¹‚ç­‰å‘½ä¸­ã€422 åˆ†ç±»æ­£ç¡®ã€429/5xx æŒ‡æ•°é€€é¿ã€ä»·æ ¼å®ˆæŠ¤/åº“å­˜é˜ˆå€¼è§¦å‘ã€æŒ‡æ ‡/æ—¥å¿—å­—æ®µé½å…¨
- **æœ¬åœ°å‘½ä»¤**ï¼šlint/type/test/build å‡é€šè¿‡

---

## 10) è‡ªæ£€æ¸…å•
- [ ] æœªè¶Šè¿‡ä¸å˜é‡ï¼ˆAPI å‰ç¼€/EF__/ef_*/UTC/Decimal/Problem Details/è¾¹ç•Œå¯¼å…¥ï¼‰
- [ ] æ”¹åŠ¨ä»…åœ¨ç™½åå•æ–‡ä»¶ï¼›æœªæ–°å¢ä¾èµ–
- [ ] äº‹åŠ¡/ä¼šè¯å®‰å…¨ï¼ˆæ— è·¨çº¿ç¨‹å…±äº«ã€æ— æœªå…³é—­ä¼šè¯ï¼‰
- [ ] å¤–éƒ¨è°ƒç”¨å«è¶…æ—¶+é‡è¯•+å¹‚ç­‰ï¼›æ— é˜»å¡ I/O
- [ ] æ–°å¢/å˜æ›´ API çš„ OpenAPI å·²æ›´æ–°ï¼Œå‘åå…¼å®¹
- [ ] æŒ‡æ ‡/æ—¥å¿—é½å…¨ä¸”è„±æ•ï¼›å‘Šè­¦è§„åˆ™å·²æ ‡æ³¨
- [ ] æµ‹è¯•è¦†ç›–å…³é”®è·¯å¾„
- [ ] å›æ»šæ–¹æ¡ˆæ˜ç¡®ï¼ˆå¦‚éœ€ DB è¿ç§»ï¼Œæä¾› downgradeï¼‰

---

## 11) è‡ªåŠ¨åŒ–å¼€å‘æµç¨‹
- **Pre-commit æ£€æŸ¥**ï¼šæäº¤å‰è‡ªåŠ¨è§¦å‘ï¼ˆruff/mypy/black/eslint/tsc/prettierï¼‰
- **æœ¬åœ°æµ‹è¯•ï¼ˆå¼ºåˆ¶ï¼‰**ï¼š
  - âš ï¸ ç¦æ­¢æœªç»æµ‹è¯•å°±æäº¤
  - æ ‡å‡†æµç¨‹ï¼šä¿®æ”¹ä»£ç  â†’ æœ¬åœ°é‡å¯ â†’ åŠŸèƒ½æµ‹è¯• â†’ ç¡®è®¤æ— è¯¯ â†’ æäº¤
  - åç«¯ä¿®æ”¹ï¼š`./restart.sh`ï¼Œæµ‹è¯• API
  - å‰ç«¯ä¿®æ”¹ï¼šåˆ·æ–°é¡µé¢ï¼Œæµ‹è¯• UI
  - æ•°æ®åº“ä¿®æ”¹ï¼šéªŒè¯è¿ç§»è„šæœ¬ï¼Œæ£€æŸ¥æ•°æ®å®Œæ•´æ€§
- **æäº¤è§„èŒƒ**ï¼špre-commit æ£€æŸ¥å¿…é¡»é€šè¿‡ï¼›æäº¤ä¿¡æ¯åŒ…å« `ğŸ¤– Generated with Claude Code`
- **æ¨é€ç­–ç•¥**ï¼šæµ‹è¯•é€šè¿‡å `git push`

---

## 12) æœåŠ¡å¯åŠ¨ä¸é‡å¯
- **å¯åŠ¨æ–¹å¼**ï¼šé¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ `./start.sh`ã€`./stop.sh`ã€`./restart.sh`
- **ç¦æ­¢**ï¼š`cd web && npm run dev`ï¼ˆä¼šåœ¨éšæœºç«¯å£å¯åŠ¨ï¼‰
- **ç«¯å£**ï¼šåç«¯ 8000ï¼Œå‰ç«¯ 3000
- **å‰ç«¯æ„å»º**ï¼š
  - æœ¬åœ°å¼€å‘ï¼š`cd web && npm run build`
  - **ç”Ÿäº§éƒ¨ç½²**ï¼š`cd web && STATIC_CDN=https://static.hjdtrading.com npm run build`ï¼ˆä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æºï¼‰

---

## 13) è¿œç¨‹éƒ¨ç½²æµç¨‹
- **SSH è®¿é—®**ï¼š`ssh ozon`
- **éƒ¨ç½²è·¯å¾„**ï¼š`/opt/euraflow`
- **åŸŸåé…ç½®**ï¼š
  - ä¸»ç«™ï¼š`euraflow.hjdtrading.com`ï¼ˆåº”ç”¨å…¥å£ï¼‰
  - é™æ€èµ„æºï¼š`static.hjdtrading.com`ï¼ˆJS/CSS/å›¾ç‰‡ CDN åŠ é€Ÿï¼‰
  - Nginx é…ç½®å‚è€ƒï¼š`docs/nginx/`
- **ç‰ˆæœ¬å·æ£€æŸ¥**ï¼š
  - æ›´æ–°æµè§ˆå™¨æ‰©å±•ç‰ˆæœ¬å‰ï¼Œå¿…é¡»å…ˆæ£€æŸ¥ `manifest.json` ä¸­çš„ç‰ˆæœ¬å·
  - ç¡®ä¿ `manifest.json` ç‰ˆæœ¬å·ä¸æ‰“åŒ…æ–‡ä»¶åç‰ˆæœ¬å·ä¸€è‡´
  - ç”¨æˆ·è„šæœ¬ç‰ˆæœ¬å·ä¹Ÿéœ€åŒæ­¥æ›´æ–°
- **æ ‡å‡†æµç¨‹**ï¼ˆæœ¬åœ°æ„å»ºåä¸Šä¼ ï¼Œé¿å…è¿œç¨‹æœåŠ¡å™¨å†…å­˜ä¸è¶³ï¼‰ï¼š
  1. æœ¬åœ°æäº¤å¹¶æ¨é€ï¼š`git add . && git commit -m "æè¿°" && git push`
  2. æœ¬åœ°æ„å»ºå‰ç«¯ï¼š`cd web && STATIC_CDN=https://static.hjdtrading.com npm run build`
  3. æ‰“åŒ…å¹¶ä¸Šä¼ distï¼š`cd web && tar -czf dist.tar.gz dist && scp dist.tar.gz ozon:/opt/euraflow/web/`
  4. è¿œç¨‹è§£å‹å¹¶åŒæ­¥ï¼š`ssh ozon "cd /opt/euraflow && git pull && cd web && tar -xzf dist.tar.gz && rm dist.tar.gz"`
  5. é‡å¯æœåŠ¡ï¼š`ssh ozon "cd /opt/euraflow && ./restart.sh"`
- **æ³¨æ„äº‹é¡¹**ï¼š
  - ğŸš« æ‰§è¡Œè¿œç¨‹éƒ¨ç½²å‘½ä»¤å‰å¿…é¡»è¯¢é—®ç”¨æˆ·ç¡®è®¤
  - âš ï¸ è¿œç¨‹æœåŠ¡å™¨å†…å­˜ä»…4GBï¼Œ**ç¦æ­¢åœ¨è¿œç¨‹æ‰§è¡Œ `npm run build`**ï¼ˆä¼šå¯¼è‡´OOMå’Œç³»ç»Ÿå¡æ­»ï¼‰
  - âœ… å¿…é¡»åœ¨æœ¬åœ°æ„å»ºåä¸Šä¼ distç›®å½•
  - âœ… ç”Ÿäº§æ„å»ºå¿…é¡»ä½¿ç”¨ `STATIC_CDN` ç¯å¢ƒå˜é‡
- **æŸ¥çœ‹æ—¥å¿—**ï¼š`ssh ozon "tail -200 /opt/euraflow/logs/backend-stderr.log 2>/dev/null || supervisorctl -c /opt/euraflow/supervisord.conf tail -200 euraflow:backend stderr"`

---

## 14) äº¤ä»˜ç‰©æ ¼å¼
- **Patch æ¸…å•**ï¼šæ–‡ä»¶ â†’ å˜æ›´ç‚¹æ‘˜è¦ï¼ˆå‡½æ•°/ç±»/æ¥å£ï¼‰
- **ä»£ç ç‰‡æ®µ**ï¼šä»…è´´å…³é”®ç‰‡æ®µï¼ˆDTO/æ¥å£ç­¾å/æ ¸å¿ƒç®—æ³•ï¼‰
- **æµ‹è¯•**ï¼šåˆ—å‡ºæµ‹è¯•æ–‡ä»¶/ç”¨ä¾‹åç§°ä¸æ–­è¨€
- **è„šæœ¬/é…ç½®**ï¼šä»…è¾“å‡ºä¸ä»»åŠ¡ç›¸å…³çš„ç‰‡æ®µ

---

## 15) å‚è€ƒé€ŸæŸ¥
**Problem Details åŒ…è£…ï¼ˆFastAPIï¼‰**
```py
from fastapi import HTTPException

def problem(status:int, code:str, title:str, detail:str|None=None):
    raise HTTPException(status_code=status, detail={
        "type":"about:blank","title":title,"status":status,
        "detail":detail,"code":code
    })
```

**Decimal å­—æ®µï¼ˆPydantic v2ï¼‰**
```py
from decimal import Decimal
from pydantic import BaseModel, Field

class PriceItem(BaseModel):
    sku: str
    price_rub: Decimal = Field(..., json_schema_extra={"format":"decimal"})
```

**æŒ‡æ ‡å‘½å**
```
ef_ozon_orders_pull_latency_ms (histogram)
ef_ozon_shipments_push_fail_total (counter)
```

**æ—¥å¿—ä½¿ç”¨**
```typescript
// å‰ç«¯
import { loggers } from '@/utils/logger';
loggers.auth.info('ç”¨æˆ·ç™»å½•æˆåŠŸ', { userId: 123 });
```

```python
# åç«¯
import logging
logger = logging.getLogger(__name__)
logger.info('è®¢å•åŒæ­¥å¼€å§‹', extra={'order_id': order_id})
```

---

## 16) å˜æ›´æ²Ÿé€š
- ä¸ç¡®å®šç‚¹å…ˆæ 3 ä¸ªå¤‡é€‰å¹¶æ’åºï¼ˆç†ç”±ï¼šå¤æ‚åº¦/å…¼å®¹æ€§/é£é™©ï¼‰
- æ‰€æœ‰å›ç­”å…ˆ Plan/Impactï¼Œå† Patch/Tests
- è‹¥ä»»åŠ¡æ— æ³•åœ¨ç™½åå•å†…å®Œæˆï¼Œæ˜ç¡®ä¾èµ–ä¸é˜»å¡

---

## 17) OZON API æ–‡æ¡£
- **æ–‡æ¡£ç›®å½•**ï¼š`docs/OzonAPI/`
- **ç´¢å¼•é¡µé¢**ï¼š`docs/OzonAPI/index.html`
- **åŸå§‹æ–‡æ¡£**ï¼š`docs/OzonSellerAPI.html`

---

## 18) æ¶æ„è§„åˆ™

### å•ä¸€æœåŠ¡åŸåˆ™
- æ¯ä¸ªåŠŸèƒ½åªèƒ½æœ‰ä¸€ä¸ªæœåŠ¡ç±»
- æ–°åŠŸèƒ½å¼€å‘å‰æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç±»ä¼¼æœåŠ¡
- å‰ç«¯ â†’ APIè·¯ç”± â†’ å•ä¸€æœåŠ¡ç±»

### OZONæœåŠ¡ç»„ç»‡
- å•†å“åŒæ­¥ï¼š`OzonSyncService.sync_products()` (ozon_sync.py)
- è®¢å•åŒæ­¥ï¼š`OzonSyncService.sync_orders()`
- çŠ¶æ€ç®¡ç†ï¼šåŸºäº OZON åŸç”Ÿå­—æ®µåˆ¤æ–­

### è·¯ç”±ç»„ç»‡è§„èŒƒ
- **ç¦æ­¢åœ¨ä¸»è·¯ç”±æ–‡ä»¶æ·»åŠ ä¸šåŠ¡è·¯ç”±**ï¼š`plugins/ef/channels/ozon/api/routes.py` åªç”¨äºæ³¨å†Œå­è·¯ç”±
- **æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†**ï¼šæ¯ä¸ªä¸šåŠ¡é¢†åŸŸåˆ›å»ºç‹¬ç«‹çš„ `{domain}_routes.py` æ–‡ä»¶
- **æ–‡ä»¶å‘½å**ï¼šåº—é“º `shop_routes.py`ã€å•†å“ `product_routes.py`ã€è®¢å• `order_routes.py` ç­‰
- **æ‹†åˆ†æ—¶æœº**ï¼šå•ä¸ªè·¯ç”±æ–‡ä»¶è¶…è¿‡ 800 è¡Œæ—¶å¿…é¡»æ‹†åˆ†
- **ä¸»è·¯ç”±æ–‡ä»¶èŒè´£**ï¼šä»…å¯¼å…¥å’Œæ³¨å†Œå­è·¯ç”±ï¼Œç¦æ­¢ç›´æ¥å®šä¹‰ä¸šåŠ¡ç«¯ç‚¹

---

## 19) å®šæ—¶ä»»åŠ¡ç®¡ç†

### ä»»åŠ¡è°ƒåº¦å™¨ï¼šç»Ÿä¸€ä½¿ç”¨ Celery Beat
- **æ¶æ„å†³ç­–**ï¼šä»…ä½¿ç”¨ Celery Beat è¿›è¡Œå®šæ—¶ä»»åŠ¡è°ƒåº¦
- **ç¦æ­¢å¼•å…¥**ï¼šAPSchedulerã€å…¶ä»–è°ƒåº¦å™¨ï¼ˆé¿å…æ¶æ„å¤æ‚åŒ–ï¼‰
- **ä¼˜åŠ¿**ï¼šç”Ÿäº§çº§ç¨³å®šæ€§ã€åˆ†å¸ƒå¼æ”¯æŒã€ä»»åŠ¡é˜Ÿåˆ—ã€è‡ªåŠ¨é‡è¯•

### æ³¨å†Œå®šæ—¶ä»»åŠ¡
åœ¨æ’ä»¶çš„ `setup()` å‡½æ•°ä¸­æ³¨å†Œï¼š

```python
async def setup(hooks) -> None:
    """æ’ä»¶åˆå§‹åŒ–å‡½æ•°"""

    # æ³¨å†Œå®šæ—¶ä»»åŠ¡
    await hooks.register_cron(
        name="ef.ozon.orders.pull",        # ä»»åŠ¡åç§°ï¼ˆå¿…é¡»ä»¥ ef. å¼€å¤´ï¼‰
        cron="*/5 * * * *",                # Cron è¡¨è¾¾å¼ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        task=pull_orders_task              # å¼‚æ­¥ä»»åŠ¡å‡½æ•°
    )
```

### Cron è¡¨è¾¾å¼ç¤ºä¾‹
```
*/5 * * * *   â†’ æ¯5åˆ†é’Ÿæ‰§è¡Œ
*/30 * * * *  â†’ æ¯30åˆ†é’Ÿæ‰§è¡Œ
15 * * * *    â†’ æ¯å°æ—¶ç¬¬15åˆ†é’Ÿæ‰§è¡Œ
0 3 * * *     â†’ æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œï¼ˆUTCï¼‰
0 22 * * *    â†’ æ¯å¤©UTC 22:00æ‰§è¡Œï¼ˆåŒ—äº¬æ—¶é—´06:00ï¼‰
0 * * * *     â†’ æ¯å°æ—¶æ‰§è¡Œ
```

### å½“å‰å®šæ—¶ä»»åŠ¡åˆ—è¡¨
ç³»ç»Ÿä¸­æ‰€æœ‰å®šæ—¶ä»»åŠ¡ç»Ÿä¸€ç”± Celery Beat è°ƒåº¦ï¼ˆå·²ä¼˜åŒ–åˆ†æ•£æ‰§è¡Œï¼Œé¿å…æ•´ç‚¹/åŠç‚¹é›†ä¸­ï¼‰ï¼š

**ç³»ç»Ÿçº§ä»»åŠ¡ï¼š**
1. `ef.core.health_check` - ç³»ç»Ÿå¥åº·æ£€æŸ¥ï¼ˆæ¯5åˆ†é’Ÿ `*/5 * * * *`ï¼‰
2. `ef.core.cleanup_results` - æ¸…ç†è¿‡æœŸä»»åŠ¡ç»“æœï¼ˆæ¯å¤©å‡Œæ™¨2:00 `0 2 * * *`ï¼‰
3. `ef.core.metrics_collection` - ç³»ç»ŸæŒ‡æ ‡é‡‡é›†ï¼ˆæ¯10åˆ†é’Ÿ `*/10 * * * *`ï¼‰

**OZON ç±»ç›®åŒæ­¥ä»»åŠ¡ï¼š**
4. `ef.ozon.category.sync` - OZON ç±»ç›®æ ‘åŒæ­¥ï¼ˆæ¯å‘¨ä¸€ 21:00 UTC `0 21 * * 1`ï¼‰
5. `ef.ozon.attributes.sync` - OZON ç±»ç›®ç‰¹å¾åŒæ­¥ï¼ˆæ¯å‘¨ä¸€ 21:30 UTC `30 21 * * 1`ï¼‰

**OZON ä¸šåŠ¡åŒæ­¥ä»»åŠ¡ï¼ˆå·²åˆ†æ•£æ‰§è¡Œï¼‰ï¼š**
6. `ef.ozon.orders.pull` - è®¢å•æ‹‰å–ï¼ˆæ¯å°æ—¶ç¬¬15å’Œ45åˆ†é’Ÿ `15,45 * * * *`ï¼‰
7. `ef.ozon.inventory.sync` - åº“å­˜åŒæ­¥ï¼ˆæ¯å°æ—¶ç¬¬20å’Œ50åˆ†é’Ÿ `20,50 * * * *`ï¼‰
8. `ef.ozon.promotions.sync` - ä¿ƒé”€æ´»åŠ¨åŒæ­¥ï¼ˆæ¯å°æ—¶ç¬¬25å’Œ55åˆ†é’Ÿ `25,55 * * * *`ï¼‰
9. `ef.ozon.promotions.health_check` - ä¿ƒé”€ç³»ç»Ÿå¥åº·æ£€æŸ¥ï¼ˆæ¯å°æ—¶ç¬¬2åˆ†é’Ÿ `2 * * * *`ï¼‰
10. `ef.ozon.cancellations.sync` - å–æ¶ˆç”³è¯·åŒæ­¥ï¼ˆæ¯å°æ—¶ç¬¬7åˆ†é’Ÿ `7 * * * *`ï¼‰
11. `ef.ozon.returns.sync` - é€€è´§ç”³è¯·åŒæ­¥ï¼ˆæ¯å°æ—¶ç¬¬12åˆ†é’Ÿ `12 * * * *`ï¼‰
12. `ef.ozon.kuajing84.material_cost` - è·¨å¢ƒå·´å£«ç‰©æ–™æˆæœ¬åŒæ­¥ï¼ˆæ¯å°æ—¶ç¬¬15åˆ†é’Ÿ `15 * * * *`ï¼‰
13. `ef.ozon.finance.sync` - OZONè´¢åŠ¡è´¹ç”¨åŒæ­¥ï¼ˆæ¯å¤©å‡Œæ™¨3:15 `15 3 * * *`ï¼‰
14. `ef.ozon.finance.transactions` - OZONè´¢åŠ¡äº¤æ˜“åŒæ­¥ï¼ˆæ¯å¤©UTC 22:00 `0 22 * * *`ï¼‰
15. `ef.ozon.labels.prefetch` - æ ‡ç­¾é¢„ç¼“å­˜ï¼ˆæ¯5åˆ†é’Ÿ `*/5 * * * *`ï¼‰
16. `ef.ozon.labels.cleanup` - æ ‡ç­¾ç¼“å­˜æ¸…ç†ï¼ˆæ¯å¤©å‡Œæ™¨4:00 `0 4 * * *`ï¼‰
17. `ef.ozon.drafts.cleanup` - è‰ç¨¿æ¸…ç†ï¼ˆæ¯å¤©å‡Œæ™¨2:10 `10 2 * * *`ï¼‰
18. `ef.ozon.collection.poll_listing_status` - é‡‡é›†è®°å½•ä¸Šæ¶çŠ¶æ€è½®è¯¢ï¼ˆæ¯10åˆ†é’Ÿ `*/10 * * * *`ï¼‰

**å…¶ä»–ä»»åŠ¡ï¼š**
19. `ef.finance.rates.refresh` - æ±‡ç‡åˆ·æ–°ï¼ˆæ¯å°æ—¶ç¬¬18åˆ†é’Ÿ `18 * * * *`ï¼‰

### æŸ¥çœ‹ä»»åŠ¡è°ƒåº¦çŠ¶æ€
```bash
# æŸ¥çœ‹ Celery Beat æ—¥å¿—
supervisorctl tail -100 euraflow:celery_beat stdout

# æŸ¥çœ‹å·²æ³¨å†Œçš„ä»»åŠ¡
./venv/bin/python -c "from ef_core.tasks.celery_app import celery_app; print(list(celery_app.conf.beat_schedule.keys()))"
```

### æ–°å¢å®šæ—¶ä»»åŠ¡æµç¨‹
1. åœ¨æ’ä»¶ `setup()` å‡½æ•°ä¸­è°ƒç”¨ `hooks.register_cron()`
2. ä»»åŠ¡å‡½æ•°å¿…é¡»æ˜¯å¼‚æ­¥å‡½æ•°ï¼ˆ`async def`ï¼‰
3. ä»»åŠ¡åç§°å¿…é¡»ä»¥ `ef.` å¼€å¤´
4. é‡å¯ Celery Beat æœåŠ¡ç”Ÿæ•ˆï¼š`./restart.sh`

### ç¦æ­¢è¡Œä¸º
- âŒ ä½¿ç”¨ APScheduler æˆ–å…¶ä»–è°ƒåº¦å™¨
- âŒ åœ¨ä»£ç ä¸­ç¡¬ç¼–ç è°ƒåº¦é€»è¾‘
- âŒ åˆ›å»ºæ•°æ®åº“é©±åŠ¨çš„è°ƒåº¦å™¨ï¼ˆå¢åŠ å¤æ‚åº¦ï¼‰

---

## 20) æµè§ˆå™¨æ‰©å±•æ‰“åŒ…
- **ç›®å½•**ï¼š`plugins/ef/channels/ozon/browser_extension/`
- **ç‰ˆæœ¬å·ç®¡ç†**ï¼š
  - ç‰ˆæœ¬å·ä»…åœ¨ `manifest.json` ä¸­çš„ `version` å­—æ®µç»´æŠ¤
  - ç”¨æˆ·å¯åœ¨æ‰©å±•ç®¡ç†é¡µé¢æŸ¥çœ‹ `manifest.json` ä¸­çš„ç‰ˆæœ¬å·
  - **ç‰ˆæœ¬å·å˜æ›´æ—¶**ï¼šå¿…é¡»åŒæ­¥æ›´æ–° `web/src/pages/ozon/ProductSelection.tsx` ä¸­ã€Œé€‰å“åŠ©æ‰‹-ä½¿ç”¨æŒ‡å—ã€çš„ç‰ˆæœ¬è¯´æ˜
- **è°ƒè¯•æ—¥å¿—æ§åˆ¶**ï¼š
  - **ç¦æ­¢**ä½¿ç”¨è¿è¡Œæ—¶å˜é‡ï¼ˆå¦‚ `window.EURAFLOW_DEBUG`ï¼‰åˆ¤æ–­æ˜¯å¦è¾“å‡ºè°ƒè¯•æ—¥å¿—
  - é€šè¿‡æ„å»ºæ—¶ç¯å¢ƒå˜é‡ `DEBUG_MODE` æ§åˆ¶ï¼š`npm run build` ä¸ºæ­£å¼ç‰ˆï¼Œ`npm run build:debug` ä¸ºè°ƒè¯•ç‰ˆ
  - è°ƒè¯•ç‰ˆåŒ…å«è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼Œæ­£å¼ç‰ˆç§»é™¤æ‰€æœ‰è°ƒè¯•æ—¥å¿—
- **åŒåŒ…æ‰“åŒ…**ï¼šæ¯æ¬¡æ‰“åŒ…ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶
  - `euraflow.zip` - æ­£å¼ç‰ˆï¼ˆæ— è°ƒè¯•æ—¥å¿—ï¼Œä¾›ç”¨æˆ·ä½¿ç”¨ï¼‰ï¼Œæ’ä»¶åç§°ä¸ºã€ŒEuraFlow OZONé€‰å“åŠ©æ‰‹ã€
  - `euraflow-debug.zip` - è°ƒè¯•ç‰ˆï¼ˆå«è°ƒè¯•æ—¥å¿—ï¼Œä¾›å¼€å‘è°ƒè¯•ï¼‰ï¼Œæ’ä»¶åç§°ä¸ºã€ŒEuraFlow OZONé€‰å“åŠ©æ‰‹[è°ƒè¯•ç‰ˆ]ã€
- **æ‰“åŒ…å‘½ä»¤**ï¼š
  ```bash
  cd plugins/ef/channels/ozon/browser_extension

  # âš ï¸ é‡è¦ï¼šå…ˆåˆ é™¤æ—§zipï¼Œé˜²æ­¢æ–‡ä»¶ç´¯ç§¯å¯¼è‡´ä½“ç§¯è†¨èƒ€
  rm -f euraflow.zip euraflow-debug.zip

  # 1. æ„å»ºå¹¶æ‰“åŒ…æ­£å¼ç‰ˆ
  npm run build
  cd dist && zip -r ../euraflow.zip manifest.json service-worker-loader.js assets/ src/ -x "*.map" && cd ..

  # 2. æ„å»ºå¹¶æ‰“åŒ…è°ƒè¯•ç‰ˆ
  npm run build:debug
  cd dist && zip -r ../euraflow-debug.zip manifest.json service-worker-loader.js assets/ src/ -x "*.map" && cd ..

  # 3. å¤åˆ¶åˆ°ä¸‹è½½ç›®å½•
  cp euraflow.zip euraflow-debug.zip /home/grom/EuraFlow/web/public/downloads/
  ```
- **åŒ…å«æ–‡ä»¶**ï¼š`dist/manifest.json`ã€`dist/service-worker-loader.js`ã€`dist/assets/*`ã€`dist/src/popup/popup.html`
- **æ’é™¤æ–‡ä»¶**ï¼š`.vite/`ã€`icons/`ã€`README.md`ã€`*.map`ã€æºä»£ç 
- **âš ï¸ æ³¨æ„**ï¼š
  - **å¿…é¡»å…ˆåˆ é™¤æ—§zip**ï¼š`zip -r` å‘½ä»¤ä¼šæ›´æ–°å·²æœ‰zipè€Œä¸æ˜¯è¦†ç›–ï¼Œå¯¼è‡´æ—§æ–‡ä»¶ç´¯ç§¯
  - ä¸åˆ é™¤æ—§zipçš„åæœï¼šåŒ…ä½“ç§¯ä¼šæŒç»­è†¨èƒ€ï¼ˆæ›¾ä»67KBè†¨èƒ€åˆ°99KBï¼‰ï¼ŒåŒ…å«å¤šä¸ªç‰ˆæœ¬çš„ç›¸åŒæ–‡ä»¶
  - æ–‡ä»¶å¿…é¡»æ”¾åœ¨ `web/public/downloads/`ï¼ˆ**ä¸æ˜¯** `web/dist/downloads/`ï¼‰
  - Nginx å·²é…ç½® `/downloads` è·¯å¾„ç›´æ¥æŒ‡å‘ `public/downloads/`
  - Vite æ„å»ºæ—¶ä¼šè‡ªåŠ¨æ’é™¤ downloads ç›®å½•ï¼Œé¿å…å†—ä½™å¤åˆ¶
  - ä¸‹è½½é“¾æ¥ï¼šæ­£å¼ç‰ˆ `/downloads/euraflow.zip`ï¼Œè°ƒè¯•ç‰ˆ `/downloads/euraflow-debug.zip`
- **ğŸš« ç¦æ­¢è¡Œä¸º**ï¼š
  - **ç»å¯¹ç¦æ­¢å°† .zip æ–‡ä»¶æäº¤åˆ° git**
  - .zip æ˜¯ç¼–è¯‘äº§ç‰©ï¼Œä»…ç”¨äºæœ¬åœ°å’ŒæœåŠ¡å™¨éƒ¨ç½²
  - å¦‚æœä¸å°å¿ƒæäº¤äº†ï¼Œå¿…é¡»ç«‹å³ä½¿ç”¨ `git rm` åˆ é™¤
  - ä¿®æ”¹æºä»£ç åï¼Œåªæäº¤æºä»£ç å˜æ›´ï¼Œä¸æäº¤æ‰“åŒ…æ–‡ä»¶
  - **ç¦æ­¢**ä½¿ç”¨ `window.EURAFLOW_DEBUG` ç­‰è¿è¡Œæ—¶å˜é‡æ§åˆ¶æ—¥å¿—è¾“å‡º

---

## 21) æœ¯è¯­è¡¨
- **TTD**ï¼šæ–°å•å¹³å°åˆ°è¾¾ç³»ç»Ÿçš„å»¶è¿Ÿ
- **é‡‘ä¸é›€/ç°åº¦**ï¼šæŒ‰åº—é“º/æ¸ é“/åœ°åŒºé€æ­¥æ”¾é‡
- **æ‚¬æŒ‚è´¦**ï¼šå¯¹è´¦å·®å¼‚æš‚å­˜æ± ï¼Œéœ€äººå·¥é—­ç¯

---

## 22) Celery ä¸ Asyncio æ··ç”¨è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™

EuraFlow é‡‡ç”¨ **FastAPIï¼ˆasyncioï¼‰+ Celeryï¼ˆasyncioï¼‰** çš„æ··åˆæ¶æ„ï¼š
- **Web å±‚ï¼ˆFastAPIï¼‰**ï¼šå¿…é¡»ä½¿ç”¨ asyncio
- **ä»»åŠ¡å±‚ï¼ˆCeleryï¼‰**ï¼šä½¿ç”¨ asyncioï¼Œä½†éµå¾ªä¸¥æ ¼è§„èŒƒ

**ä¸æ¨èå…¨éƒ¨æ”¹ä¸ºåŒæ­¥**ï¼š
- âŒ FastAPI å¿…é¡»ç”¨ asyncioï¼ˆæ¡†æ¶é™åˆ¶ï¼‰
- âŒ å…¨éƒ¨æ”¹ä¸ºåŒæ­¥ä¼šå¯¼è‡´ Web å±‚æ€§èƒ½å¤§å¹…ä¸‹é™
- âœ… è§„èŒƒæ··ç”¨è¾¹ç•Œï¼Œé¿å…äº‹ä»¶å¾ªç¯å†²çª

---

### Celery ä»»åŠ¡ä¸­ä½¿ç”¨ asyncio çš„æ ‡å‡†æ¨¡å¼

#### å¿…é¡»éµå®ˆçš„è§„åˆ™

1. **äº‹ä»¶å¾ªç¯ç®¡ç†**ï¼š
   - æ¯ä¸ªä»»åŠ¡åªåˆ›å»ºä¸€æ¬¡äº‹ä»¶å¾ªç¯
   - ä½¿ç”¨ `asyncio.new_event_loop()` åˆ›å»ºç‹¬ç«‹äº‹ä»¶å¾ªç¯
   - ä»»åŠ¡ç»“æŸæ—¶å¿…é¡»å…³é—­ï¼š`loop.close()` + `asyncio.set_event_loop(None)`

2. **æ•°æ®åº“è¿æ¥**ï¼š
   - åœ¨äº‹ä»¶å¾ªç¯ä¸­åˆ›å»º AsyncSession
   - ä¸è¦è·¨äº‹ä»¶å¾ªç¯å…±äº« Session
   - ä½¿ç”¨ `async with db_manager.get_session() as db:` ç¡®ä¿æ­£ç¡®å…³é—­

3. **æ’ä»¶åˆå§‹åŒ–**ï¼š
   - âŒ ç¦æ­¢åœ¨æ’ä»¶ `setup()` å‡½æ•°ä¸­è°ƒç”¨ `get_db_manager()`
   - âŒ ç¦æ­¢åœ¨æ’ä»¶ `setup()` å‡½æ•°ä¸­æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
   - âœ… ä»»åŠ¡æ³¨å†Œæ—¶ä½¿ç”¨ç¡¬ç¼–ç çš„é»˜è®¤ cron è¡¨è¾¾å¼
   - âœ… ä»»åŠ¡æ‰§è¡Œæ—¶å†ä»æ•°æ®åº“è¯»å–é…ç½®å’Œæ•°æ®

4. **Celery Worker é…ç½®**ï¼š
   - âœ… å¿…é¡»ä½¿ç”¨ `prefork` poolï¼ˆä¸ä½¿ç”¨ geventï¼‰
   - âœ… å¹¶å‘æ•°ï¼šCPU æ ¸å¿ƒæ•° Ã— 2-4ï¼ˆé€šå¸¸ 8-16ï¼‰

---

### æ ‡å‡†ä»£ç æ¨¡æ¿

#### Celery ä»»åŠ¡æ¨¡æ¿ï¼ˆæ­£ç¡® âœ…ï¼‰

```python
from ef_core.tasks.celery_app import celery_app
import asyncio

@celery_app.task(bind=True, name="ef.xxx.yyy")
def my_task(self, **kwargs):
    """
    Celery ä»»åŠ¡æ ‡å‡†æ¨¡æ¿

    è¯´æ˜ï¼š
    1. ä»»åŠ¡å‡½æ•°æœ¬èº«æ˜¯åŒæ­¥çš„ï¼ˆdefï¼Œä¸æ˜¯ async defï¼‰
    2. å†…éƒ¨åˆ›å»ºç‹¬ç«‹çš„äº‹ä»¶å¾ªç¯æ¥è¿è¡Œå¼‚æ­¥é€»è¾‘
    3. ä»»åŠ¡ç»“æŸæ—¶æ­£ç¡®æ¸…ç†äº‹ä»¶å¾ªç¯
    """

    def run_async():
        """åœ¨ç‹¬ç«‹äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œå¼‚æ­¥é€»è¾‘"""
        # åˆ›å»ºæ–°çš„äº‹ä»¶å¾ªç¯
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)

        try:
            # è¿è¡Œå¼‚æ­¥é€»è¾‘
            return loop.run_until_complete(async_logic())
        finally:
            # å…³é—­äº‹ä»¶å¾ªç¯
            loop.close()
            # æ¸…ç†äº‹ä»¶å¾ªç¯å¼•ç”¨ï¼ˆé‡è¦ï¼ï¼‰
            asyncio.set_event_loop(None)

    return run_async()


async def async_logic():
    """å¼‚æ­¥ä¸šåŠ¡é€»è¾‘"""
    from ef_core.database import get_db_manager
    from sqlalchemy import select

    db_manager = get_db_manager()

    # åœ¨äº‹ä»¶å¾ªç¯ä¸­åˆ›å»ºæ•°æ®åº“ä¼šè¯
    async with db_manager.get_session() as db:
        # æ‰§è¡Œæ•°æ®åº“æ“ä½œ
        result = await db.execute(select(MyModel))
        items = result.scalars().all()

        # è°ƒç”¨å¼‚æ­¥æœåŠ¡
        for item in items:
            await process_item(item)
```

#### æ’ä»¶åˆå§‹åŒ–æ¨¡æ¿ï¼ˆæ­£ç¡® âœ…ï¼‰

```python
# plugins/ef/xxx/__init__.py

async def setup(hooks) -> None:
    """
    æ’ä»¶åˆå§‹åŒ–å‡½æ•°

    âŒ ç¦æ­¢ï¼šè®¿é—®æ•°æ®åº“ã€åˆ›å»ºæ•°æ®åº“ç®¡ç†å™¨
    âœ… å…è®¸ï¼šæ³¨å†Œä»»åŠ¡ã€æ³¨å†Œè·¯ç”±ã€è®¢é˜…äº‹ä»¶
    """

    # âœ… æ­£ç¡®ï¼šç›´æ¥æ³¨å†Œä»»åŠ¡ï¼Œä½¿ç”¨é»˜è®¤ cron
    await hooks.register_cron(
        name="ef.xxx.my_task",
        cron="*/30 * * * *",  # ç¡¬ç¼–ç çš„é»˜è®¤å€¼
        task=my_task
    )

    # âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆç¦æ­¢ï¼‰ï¼š
    # from ef_core.database import get_db_manager
    # db_manager = get_db_manager()  # âŒ ç¦æ­¢ï¼
    # async with db_manager.get_session() as db:
    #     config = await db.execute(...)  # âŒ ç¦æ­¢ï¼
```

#### ä»»åŠ¡æ‰§è¡Œæ—¶æ£€æŸ¥é…ç½®æ¨¡æ¿ï¼ˆæ­£ç¡® âœ…ï¼‰

```python
async def async_logic():
    """ä»»åŠ¡æ‰§è¡Œæ—¶å†æŸ¥è¯¢æ•°æ®åº“é…ç½®"""
    from ef_core.database import get_db_manager
    from plugins.ef.system.sync_service.models.sync_service import SyncService
    from sqlalchemy import select

    db_manager = get_db_manager()

    # æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å¯ç”¨
    async with db_manager.get_session() as db:
        result = await db.execute(
            select(SyncService).where(SyncService.service_key == "my_service")
        )
        service = result.scalar_one_or_none()

        # å¦‚æœä»»åŠ¡è¢«ç¦ç”¨ï¼Œç›´æ¥è¿”å›
        if service and not service.is_enabled:
            logger.info("Task ef.xxx.my_task is disabled, skipping")
            return

        # æ‰§è¡Œä»»åŠ¡é€»è¾‘
        await do_work()
```

---

### å¸¸è§é”™è¯¯ä¸ä¿®å¤

#### é”™è¯¯ 1ï¼šåœ¨åŒä¸€ä»»åŠ¡ä¸­å¤šæ¬¡åˆ›å»ºäº‹ä»¶å¾ªç¯

```python
# âŒ é”™è¯¯
@celery_app.task
def bad_task():
    # ç¬¬ä¸€æ¬¡åˆ›å»ºäº‹ä»¶å¾ªç¯
    loop1 = asyncio.new_event_loop()
    loop1.run_until_complete(task1())
    loop1.close()

    # ç¬¬äºŒæ¬¡åˆ›å»ºäº‹ä»¶å¾ªç¯ï¼ˆæµªè´¹èµ„æºï¼‰
    loop2 = asyncio.new_event_loop()
    loop2.run_until_complete(task2())
    loop2.close()

# âœ… æ­£ç¡®
@celery_app.task
def good_task():
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    try:
        # åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œæ‰€æœ‰å¼‚æ­¥æ“ä½œ
        loop.run_until_complete(async_main())
    finally:
        loop.close()
        asyncio.set_event_loop(None)

async def async_main():
    await task1()
    await task2()
```

#### é”™è¯¯ 2ï¼šæ’ä»¶åˆå§‹åŒ–æ—¶è®¿é—®æ•°æ®åº“

```python
# âŒ é”™è¯¯
async def setup(hooks):
    from ef_core.database import get_db_manager
    db_manager = get_db_manager()  # âŒ åˆ›å»ºæ•°æ®åº“ç®¡ç†å™¨å•ä¾‹

    async with db_manager.get_session() as db:
        shops = await db.execute(select(OzonShop))  # âŒ æŸ¥è¯¢æ•°æ®åº“
        for shop in shops:
            await hooks.register_cron(...)  # ä¸ºæ¯ä¸ªåº—é“ºæ³¨å†Œä»»åŠ¡

# âœ… æ­£ç¡®
async def setup(hooks):
    # åªæ³¨å†Œä¸€ä¸ªä»»åŠ¡ï¼Œä¸è®¿é—®æ•°æ®åº“
    await hooks.register_cron(
        name="ef.ozon.process_shops",
        cron="*/5 * * * *",
        task=process_all_shops
    )

async def async_logic():
    """ä»»åŠ¡æ‰§è¡Œæ—¶æŸ¥è¯¢åº—é“ºåˆ—è¡¨"""
    async with get_db_manager().get_session() as db:
        shops = await db.execute(select(OzonShop).where(OzonShop.status == "active"))
        for shop in shops:
            await process_shop(shop)
```

#### é”™è¯¯ 3ï¼šä½¿ç”¨ gevent pool

```bash
# supervisord.conf

# âŒ é”™è¯¯
command=.../celery -A ef_core.tasks.celery_app worker --pool=gevent --concurrency=100

# âœ… æ­£ç¡®
command=.../celery -A ef_core.tasks.celery_app worker --pool=prefork --concurrency=10
```

---

### ä»£ç å®¡æŸ¥æ¸…å•

æ–°å¢æˆ–ä¿®æ”¹ Celery ä»»åŠ¡æ—¶ï¼Œå¿…é¡»æ£€æŸ¥ï¼š

- [ ] ä»»åŠ¡å‡½æ•°ä½¿ç”¨æ ‡å‡†æ¨¡æ¿ï¼ˆåˆ›å»ºç‹¬ç«‹äº‹ä»¶å¾ªç¯ï¼‰
- [ ] ä»»åŠ¡ç»“æŸæ—¶æ­£ç¡®å…³é—­äº‹ä»¶å¾ªç¯ï¼ˆ`loop.close()` + `set_event_loop(None)`ï¼‰
- [ ] æ’ä»¶ `setup()` å‡½æ•°ä¸è°ƒç”¨ `get_db_manager()`
- [ ] æ’ä»¶ `setup()` å‡½æ•°ä¸æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
- [ ] ä»»åŠ¡æ³¨å†Œä½¿ç”¨ç¡¬ç¼–ç çš„é»˜è®¤ cron è¡¨è¾¾å¼
- [ ] ä»»åŠ¡æ‰§è¡Œæ—¶ä»æ•°æ®åº“è¯»å–é…ç½®ï¼ˆæ£€æŸ¥ `is_enabled`ï¼‰
- [ ] Celery Worker ä½¿ç”¨ `prefork` poolï¼ˆä¸ä½¿ç”¨ geventï¼‰

---

### æ’æŸ¥ä¸éªŒè¯

#### éªŒè¯äº‹ä»¶å¾ªç¯ç®¡ç†

```bash
# 1. æ£€æŸ¥ä»»åŠ¡æ˜¯å¦éµå¾ªæ ‡å‡†æ¨¡æ¿
grep -A 20 "@celery_app.task" plugins/ef/*/tasks/*.py | grep -E "new_event_loop|run_until_complete|loop.close"

# 2. æ£€æŸ¥æ˜¯å¦æ­£ç¡®æ¸…ç†äº‹ä»¶å¾ªç¯
grep -A 30 "@celery_app.task" plugins/ef/*/tasks/*.py | grep "set_event_loop(None)"
```

#### éªŒè¯æ’ä»¶åˆå§‹åŒ–

```bash
# æ£€æŸ¥æ’ä»¶ setup() æ˜¯å¦è®¿é—®æ•°æ®åº“
grep -A 20 "async def setup" plugins/ef/*/__init__.py | grep -E "get_db_manager|AsyncSession"
```

#### éªŒè¯ Celery Worker é…ç½®

```bash
# æ£€æŸ¥ pool ç±»å‹
grep "pool=" supervisord.conf

# é¢„æœŸè¾“å‡ºï¼š--pool=prefork
```

---

### å¤–éƒ¨ API è°ƒç”¨ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

#### ä»»åŠ¡å±‚å¯æ”¹ä¸ºåŒæ­¥ HTTP å®¢æˆ·ç«¯

**åœºæ™¯**ï¼šCelery ä»»åŠ¡ä¸­è°ƒç”¨å¤–éƒ¨ APIï¼ˆOZON APIã€ç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰

```python
# å½“å‰ï¼ˆå¼‚æ­¥ï¼‰- éœ€è¦åœ¨äº‹ä»¶å¾ªç¯ä¸­è¿è¡Œ
async def fetch_data():
    async with httpx.AsyncClient() as client:
        response = await client.post(url, json=data, timeout=30.0)
        return response.json()

# ä¼˜åŒ–ï¼ˆåŒæ­¥ï¼‰- ç®€åŒ–ä»£ç ï¼Œå‡å°‘äº‹ä»¶å¾ªç¯å¼€é”€
def fetch_data():
    import httpx
    with httpx.Client() as client:
        response = client.post(url, json=data, timeout=30.0)
        return response.json()
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä»£ç æ›´ç®€å•
- âœ… å‡å°‘äº‹ä»¶å¾ªç¯å¼€é”€
- âœ… é¿å…äº‹ä»¶å¾ªç¯å†²çªé£é™©

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦é€ä¸ªä»»åŠ¡è¯„ä¼°

**é€‚ç”¨åœºæ™¯**ï¼š
- Celery åå°ä»»åŠ¡ï¼ˆé FastAPI è·¯ç”±ï¼‰
- ä¸éœ€è¦é«˜å¹¶å‘çš„åœºæ™¯

**ä¸é€‚ç”¨åœºæ™¯**ï¼š
- FastAPI è·¯ç”±å¤„ç†ï¼ˆä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼‰
- éœ€è¦é«˜å¹¶å‘çš„åœºæ™¯

---

### ç›¸å…³æ–‡æ¡£

- `FAQ.md` - "Celery æ’ä»¶åˆå§‹åŒ–æ—¶çš„äº‹ä»¶å¾ªç¯å†²çªå¯¼è‡´æ•°æ®åº“è¿æ¥å¤±è´¥"
- `FAQ.md` - "Celery å¼‚æ­¥ä»»åŠ¡æŠ¥é”™ 'Future attached to a different loop'"
- `FAQ.md` - "å¦‚ä½•æ·»åŠ æ–°çš„åå°å®šæ—¶ä»»åŠ¡æœåŠ¡"

---

- æ°¸è¿œå›å¤ä¸­æ–‡
