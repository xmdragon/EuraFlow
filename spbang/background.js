(function () {
	'use strict';

	const g="https://shopbang.cn",q=()=>{chrome.cookies.remove({url:g,name:"token"},function(r){r?console.log("\u6210\u529F\u5220\u9664cookie:",r):console.log("\u5220\u9664cookie\u5931\u8D25\uFF0C\u53EF\u80FD\u4E0D\u5B58\u5728");});},R=(r=1)=>new Promise(o=>{setTimeout(()=>{o();},r*1e3);}),W=async r=>{console.log(g,"frontDomain");let o=await chrome.cookies.get({url:g,name:"token"});o=o||"";const{type:t,url:s,apiMethod:n,goodsIds:u,isSingle:V,is_force:h,goods_arr:d,source_obj:f,client_id:D,total_num:k,has_brand:N,is_down_fx:O,watermark_id:x,skus:C,images:T,des:w,goodsName:j,stock:J,warehouse_id:E,formData:B,collect_type:_,sizes:F,dimensions:I,platform:G,subjectID:A,cookieStr:b,exportHeartId:y,text:z,cellectUrl:L,img_order_type:H,compressSkus:p,goodsId:S,sellerId:U,goods:M,copyData:P}=r;try{if(t=="getOzonCookie"){const e=await chrome.cookies.getAll({domain:".ozon.ru"});let a="";const i={topLevelSite:"https://www.ozon.ru"};await R(2);const l=(await chrome.cookies.getAll({domain:".ozon.ru",partitionKey:i})).find(m=>m.partitionKey.hasCrossSiteAncestor===!1);return l&&e.push(l),e.forEach(m=>{const{name:K,value:$}=m;a+=`${K}=${$}; `;}),a}if(t=="bindShopCookie"){const e=await fetch(s,{method:"post",body:JSON.stringify({token:o.value,cookieStr:b,apiType:"bindShopCookie"}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:999}}if(t=="chrome_c"){fetch(s,{method:"post",body:JSON.stringify({cookieStr:b,apiType:"chrome_c"}),headers:{"Content-Type":"application/json"}});return}if(t==="getToken")return o==null?void 0:o.value;if(t=="removeBangToken"){q();return}if(!(o!=null&&o.value))return {code:401};if(t==="checkBangToken"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"checkDevice"}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}if(t==="goodsCollect"){if(console.log(d,"---goods_arr"),!d.length)return {code:-1,message:"\u91C7\u96C6\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"};const{goods_source_url:e,goods_source_remark:a,up_price:i}=f,c=await fetch(s,{method:n,body:JSON.stringify({goods_arr:d,token:o.value,apiType:"goodsCollect",is_force:h,goods_source_url:e,goods_source_remark:a,up_price:i,dimensions:I}),headers:{"Content-Type":"application/json"}});return c.ok?await c.json():{code:-1}}else if(t==="goodsCollect1688"){const{goods_source_url:e}=f,a=await fetch(s,{method:n,body:JSON.stringify({skus:C,images:T,des:w,goodsName:j,token:o.value,apiType:"goodsCollect1688",is_force:h,goods_source_url:e,collect_type:_,compressSkus:p}),headers:{"Content-Type":"application/json"}});return a.ok?await a.json():{code:-1}}else if(t==="goodsCollectLinkGoods"){const{goods_source_url:e,up_price:a,goods_source_remark:i}=f,c=await fetch(s,{method:n,body:JSON.stringify({skus:C,des:w,goodsName:j,token:o.value,apiType:"goodsCollectLinkGoods",is_force:h,goods_source_url:e,collect_url:L,formData:B,collect_type:_,sizes:F,images:T,up_price:a,goods_source_remark:i,is_new_plugin:!0,compressSkus:p}),headers:{"Content-Type":"application/json"}});return c.ok?await c.json():{code:-1}}else if(t==="getGoodsInfoByIds"){const e=await fetch(s,{method:n,body:JSON.stringify({goodsIds:u,token:o.value,apiType:"getGoodsInfoByIds",is_new:!0,v:4}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t==="getChromeUserInfo"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"getChromeUserInfo",platform:G}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t==="upGoods"){const e=await fetch(s,{method:n,body:JSON.stringify({goods:d,token:o.value,client_id:D,use_pack:!0,total_num:k||0,has_brand:N,is_down_fx:O,watermark_id:x,apiType:"batchCreateGoods",stock:J,warehouse_id:E,img_order_type:H,compressSkus:p,is_compress:p}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t==="getAttrBySubjectID"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"getAttrBySubjectID",subjectID:A}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1,message:"\u7CFB\u7EDF\u9519\u8BEF"}}else if(t==="getLocalGoodsIds"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"getLocalGoodsIds",goodsIds:u}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t==="getGoodsByexportData"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"getGoodsByexportData",goodsIds:u}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t==="exportTableHeartbeat"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"exportTableHeartbeat",exportHeartId:y}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t==="checkChromeExportDevice"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"checkChromeExportDevice",exportHeartId:y}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t==="finishExportTable"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"finishExportTable",exportHeartId:y}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t=="translateText"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"translateText",text:z}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t=="getCopyData"){const e=await fetch(s,{method:n,body:JSON.stringify({limit:"10",name:S+""}),headers:{priority:"u=1, i","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"none","sec-fetch-storage-access":"active","Content-Type":"application/json","x-o3-company-id":U,"x-o3-app-name":"seller-ui","x-o3-language":"zh-Hans","x-o3-page-type":"products-other","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br","Cache-Control":"no-cache","accept-language":"zh-Hans"}});return e.ok?await e.json():{code:-1}}else if(t=="getGoodsCommissions"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"getGoodsCommissions",goods:M}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t=="hasCopyDataByGoodsId"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"hasCopyDataByGoodsId",goodsId:S}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}else if(t=="addCopyData"){const e=await fetch(s,{method:n,body:JSON.stringify({token:o.value,apiType:"addCopyData",copyData:P}),headers:{"Content-Type":"application/json"}});return e.ok?await e.json():{code:-1}}}catch(e){return console.log(e,"===================="),{code:-1}}};chrome.runtime.onMessage.addListener((r,o,t)=>(W(r).then(s=>{t(s);}),!0));chrome.cookies.onChanged.addListener(r=>{if(!r.removed&&r.cookie&&r.cookie.name=="_m_h5_tk"){var o=r.cookie.value;o.indexOf("_")>-1&&(o=o.split("_")[0]),o&&o.length>0&&(r.cookie.domain==".taobao.com"?chrome.storage.local.set({spbtaobaoh5tk:o},function(){}):r.cookie.domain==".tmall.com"&&chrome.storage.local.set({spbtmallh5tk:o},function(){}));}});const v="xhr-interceptor";chrome.tabs.onUpdated.addListener((r,o)=>{o.status==="complete"&&chrome.scripting.getRegisteredContentScripts({},t=>{t.some(n=>n.id===v)||Q();});});function Q(){chrome.scripting.registerContentScripts([{id:v,js:["ozon_min.js"],matches:["https://seller.ozon.ru/*"],runAt:"document_start",world:"MAIN",allFrames:!0}],()=>{chrome.runtime.lastError?console.error("\u811A\u672C\u6CE8\u518C\u5931\u8D25:",chrome.runtime.lastError):console.log("\u4E3B\u4E16\u754C\u811A\u672C\u6CE8\u518C\u6210\u529F");});}

})();
